MediaWiki code search! (powered by hound)

We use etsy's hound as the backend for codesearch. The search functionality
is great, but the UI is a bit lacking, so we work around it a bit.

== Setup ==
This guide is based on setting up a new instance on the Wikimedia
Cloud VPS infrastructure. Currently we use Debian Buster medium
sized images.

After creating the instance, you should enable the `role::labs::lvm::srv`
puppet class, which will create a separate partition for `/srv`. We then
want to modify the filesystem so we get some more inodes per available
storage. Note that you should disable puppet so it won't interfere.

 sudo puppet agent --disable "messing with partitions"
 sudo umount /srv
 sudo mkfs.ext4 -T news /dev/mapper/vd-second--local--disk
 sudo mount /srv
 sudo puppet agent --enable

Running `df -hi` should show an increase in available inodes. You can
proceed with actually setting up codesearch now by enabling the puppet
role: `role::codesearch`.

 # Force a puppet run
 sudo puppet agent -tv

 # operations/puppet is special (T211999)
 cd /srv/puppet
 git symbolic-ref refs/remotes/origin/master refs/remotes/origin/production
 git symbolic-ref refs/heads/master refs/heads/production
 # Verify with git show-ref

 ./write_config.py
 sudo cp *.service /etc/systemd/system/
 sudo MODE=start ./manage.sh

If that works, then `curl http://localhost:3002/` should work, and you can point
a web proxy to that port.

Once you're happy with what is running, you should run
`sudo MODE=enable ./manage.sh` so that the services will automatically start
upon boot.

The hound- instances will be automatically restarted by systemd after 24
hours, which will pick up any new config changes.

== Constraints ==
We don't want to modify or fork hound. Really we just want to use the upstream
docker images without modification. So we use a flask application to proxy
requests to hound, and inject our HTML during that process.

== License ==
Hound is (C) 2014, Etsy, Inc. under the terms of the MIT license, see
<https://github.com/etsy/hound/blob/master/LICENSE> for details.

codesearch is (C) 2017, Kunal Mehta under the terms of the GPL, v3 or any
later version. See COPYING for details.

The favicon is a combination of the MediaWiki logo (Public domain) by Anthere,
and the Git logo (CC-BY 3.0) by Jason Long.
See <https://creativecommons.org/licenses/by/3.0/> for details.
